<!DOCTYPE html>
<html>
<head>
    <title>Simple NERV Test</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; }
        #canvas { border: 2px solid #0f0; background: #111; }
        #output { margin-top: 10px; padding: 10px; }
    </style>
</head>
<body>
    <h1>Simple NERV Canvas Test</h1>
    <canvas id="canvas" width="600" height="400"></canvas>
    <div id="output">Click on the canvas to place points...</div>
    
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const output = document.getElementById('output');
        let points = [];
        
        // Draw grid
        function drawGrid() {
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 0.5;
            for (let x = 0; x <= 600; x += 20) {
                ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, 400); ctx.stroke();
            }
            for (let y = 0; y <= 400; y += 20) {
                ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(600, y); ctx.stroke();
            }
        }
        
        // Draw point
        function drawPoint(x, y, label) {
            ctx.fillStyle = '#0f0';
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.fillStyle = '#fff';
            ctx.font = '12px monospace';
            ctx.fillText(label, x + 8, y - 8);
        }
        
        // Handle clicks
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            points.push({x, y});
            const label = `P${points.length}`;
            
            drawPoint(x, y, label);
            output.innerHTML += `<br>Point ${label} placed at (${x.toFixed(1)}, ${y.toFixed(1)})`;
            
            // Test API call
            fetch('http://localhost:8001/api/v1/geometry/points', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    point_data: { x, y, label },
                    construction_space_data: {
                        points: {}, lines: {}, circles: {}, history: []
                    }
                })
            })
            .then(r => r.json())
            .then(data => {
                console.log('✅ API Response:', data);
                output.innerHTML += ` <span style="color: #0a0">[API: OK]</span>`;
            })
            .catch(e => {
                console.log('❌ API Error:', e);
                output.innerHTML += ` <span style="color: #f00">[API: ERROR]</span>`;
            });
        });
        
        // Initialize
        drawGrid();
        output.innerHTML = 'Canvas ready! Click to place points and test API...';
    </script>
</body>
</html>